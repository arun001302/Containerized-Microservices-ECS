# Containerized Microservices with AWS ECS Fargate

A production-ready microservices architecture demonstrating modern cloud-native development practices using Docker, AWS ECS Fargate, and Infrastructure as Code.

![Architecture](https://img.shields.io/badge/AWS-ECS_Fargate-orange) ![Docker](https://img.shields.io/badge/Docker-Container-blue) ![Node.js](https://img.shields.io/badge/Node.js-18-green) ![CloudFormation](https://img.shields.io/badge/IaC-CloudFormation-yellow)

## ğŸš€ Live Demo

**API Base URL**: `http://microservices-alb-1563767057.us-east-1.elb.amazonaws.com`

### Endpoints

**User Service:**
- `GET /api/users` - List all users
- `GET /api/users/:id` - Get user by ID
- `POST /api/users` - Create new user
- `PUT /api/users/:id` - Update user
- `DELETE /api/users/:id` - Delete user

**Product Service:**
- `GET /api/products` - List all products
- `GET /api/products/:id` - Get product by ID
- `GET /api/products?category=Electronics` - Filter by category
- `POST /api/products` - Create new product
- `PUT /api/products/:id` - Update product
- `DELETE /api/products/:id` - Delete product

**Try it:**
```bash
curl http://microservices-alb-1563767057.us-east-1.elb.amazonaws.com/api/users
curl http://microservices-alb-1563767057.us-east-1.elb.amazonaws.com/api/products
```

---

## ğŸ“‹ Table of Contents

- [Architecture](#architecture)
- [Features](#features)
- [Technologies Used](#technologies-used)
- [Project Structure](#project-structure)
- [Prerequisites](#prerequisites)
- [Deployment Guide](#deployment-guide)
- [Testing](#testing)
- [Monitoring](#monitoring)
- [Cost Optimization](#cost-optimization)
- [Cleanup](#cleanup)
- [What I Learned](#what-i-learned)

---

## ğŸ—ï¸ Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Internet                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Application Load     â”‚
              â”‚ Balancer (ALB)       â”‚
              â”‚ Port 80              â”‚
              â”‚ Path-based Routing   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                               â”‚
         â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Target Group    â”‚            â”‚ Target Group    â”‚
â”‚ (User Service)  â”‚            â”‚ (Product Svc)   â”‚
â”‚ Blue/Green      â”‚            â”‚ Blue/Green      â”‚
â”‚ Port 3000       â”‚            â”‚ Port 3001       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚
         â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         VPC - Private Subnets (Multi-AZ)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ECS Fargate    â”‚  â”‚  ECS Fargate    â”‚      â”‚
â”‚  â”‚  User Service   â”‚  â”‚  Product Serviceâ”‚      â”‚
â”‚  â”‚  Container      â”‚  â”‚  Container      â”‚      â”‚
â”‚  â”‚  (Auto-scaling) â”‚  â”‚  (Auto-scaling) â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ NAT Gateway  â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Amazon     â”‚          â”‚  CloudWatch  â”‚
â”‚     ECR      â”‚          â”‚ Logs/Metrics â”‚
â”‚  (Images)    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Components

**Networking Layer:**
- VPC with public and private subnets across 2 Availability Zones
- Internet Gateway for public subnet connectivity
- NAT Gateway for private subnet internet access
- Route tables for traffic management

**Compute Layer:**
- ECS Fargate for serverless container orchestration
- Auto-scaling policies based on CPU utilization
- Health checks for automatic container replacement

**Load Balancing:**
- Application Load Balancer with path-based routing
- Blue/Green target groups for zero-downtime deployments
- Health checks for target registration

**Container Registry:**
- Amazon ECR for Docker image storage
- Automated vulnerability scanning
- Lifecycle policies for image management

**Monitoring & Logging:**
- CloudWatch Logs for centralized logging
- CloudWatch Metrics for performance monitoring
- Container Insights enabled

---

## âœ¨ Features

### Production-Ready Architecture
- âœ… **High Availability**: Multi-AZ deployment across 2 availability zones
- âœ… **Auto-Scaling**: Automatic scaling based on CPU/memory metrics
- âœ… **Zero-Downtime Deployments**: Blue/green deployment strategy
- âœ… **Health Monitoring**: Automatic health checks and container restart
- âœ… **Centralized Logging**: CloudWatch integration for all services

### Security Best Practices
- âœ… **Network Isolation**: Private subnets for containers
- âœ… **Least Privilege**: IAM roles with minimal permissions
- âœ… **Security Groups**: Strict firewall rules
- âœ… **Non-root Containers**: Containers run as non-privileged users
- âœ… **Image Scanning**: Automated vulnerability scanning

### Infrastructure as Code
- âœ… **5 CloudFormation Stacks**: Complete infrastructure automation
- âœ… **Modular Design**: Easy to update and maintain
- âœ… **Version Controlled**: All infrastructure code in Git
- âœ… **Reproducible**: Deploy to any AWS account/region

### Microservices Design
- âœ… **Service Independence**: Each service can scale and deploy independently
- âœ… **RESTful APIs**: Standard HTTP methods and JSON responses
- âœ… **Health Endpoints**: Monitoring and load balancer integration
- âœ… **Containerized**: Consistent environments across dev/prod

---

## ğŸ› ï¸ Technologies Used

### AWS Services
- **Amazon ECS Fargate** - Serverless container orchestration
- **Amazon ECR** - Container registry
- **Application Load Balancer** - Layer 7 load balancing
- **Amazon VPC** - Network isolation
- **CloudWatch** - Logging and monitoring
- **IAM** - Identity and access management
- **CloudFormation** - Infrastructure as Code

### Development Stack
- **Node.js 18** - Runtime environment
- **Express.js** - Web framework
- **Docker** - Containerization
- **Git** - Version control

### DevOps Tools
- **AWS CLI** - AWS resource management
- **Docker CLI** - Container management
- **Bash Scripts** - Deployment automation

---

## ğŸ“ Project Structure
```
containerized-microservices-ecs/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ user-service/
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ .dockerignore
â”‚   â””â”€â”€ product-service/
â”‚       â”œâ”€â”€ Dockerfile
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ index.js
â”‚       â””â”€â”€ .dockerignore
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ cloudformation/
â”‚   â”‚   â”œâ”€â”€ 01-vpc-network.yaml
â”‚   â”‚   â”œâ”€â”€ 02-ecr-repositories.yaml
â”‚   â”‚   â”œâ”€â”€ 03-ecs-cluster.yaml
â”‚   â”‚   â”œâ”€â”€ 04-alb.yaml
â”‚   â”‚   â””â”€â”€ 05-ecs-services.yaml
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ deploy-infrastructure.sh
â”‚       â”œâ”€â”€ push-images.sh
â”‚       â””â”€â”€ cleanup.sh
â”œâ”€â”€ buildspec.yml
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## ğŸ“¦ Prerequisites

Before deploying this project, ensure you have:

1. **AWS Account** with administrative access
2. **AWS CLI** installed and configured
```bash
   aws configure
   # Enter your AWS Access Key ID, Secret Access Key, and default region (us-east-1)
```
3. **Docker Desktop** installed and running
4. **Git** installed
5. **Basic knowledge** of AWS, Docker, and command line

---

## ğŸš€ Deployment Guide

### Step 1: Clone the Repository
```bash
git clone https://github.com/arun001302/Containerized-Microservices-ECS.git
cd Containerized-Microservices-ECS
```

### Step 2: Deploy AWS Infrastructure

Deploy all CloudFormation stacks:
```bash
cd infrastructure/scripts
chmod +x *.sh
./deploy-infrastructure.sh
```

This will create (in order):
1. VPC and networking (3-4 minutes)
2. ECR repositories (1 minute)
3. ECS cluster and IAM roles (2-3 minutes)
4. Application Load Balancer (3-4 minutes)
5. ECS services (3-5 minutes)

**Total deployment time: ~15 minutes**

### Step 3: Build and Push Docker Images
```bash
# Login to ECR
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin <YOUR_ACCOUNT_ID>.dkr.ecr.us-east-1.amazonaws.com

# Build and push images
./push-images.sh
```

This will:
- Build Docker images for both services
- Tag images with `latest` and commit hash
- Push images to ECR
- Trigger ECS service updates

### Step 4: Get Your ALB URL
```bash
aws cloudformation describe-stacks \
  --stack-name microservices-alb \
  --query "Stacks[0].Outputs[?OutputKey=='LoadBalancerDNS'].OutputValue" \
  --output text
```

### Step 5: Test Your Services

Wait 2-3 minutes for containers to start, then test:
```bash
# Save ALB URL
export ALB_URL="http://<your-alb-dns>"

# Test endpoints
curl $ALB_URL/api/users
curl $ALB_URL/api/products
```

---

## ğŸ§ª Testing

### Manual Testing

**Test User Service:**
```bash
# List all users
curl http://<alb-url>/api/users

# Get specific user
curl http://<alb-url>/api/users/1

# Create new user
curl -X POST http://<alb-url>/api/users \
  -H "Content-Type: application/json" \
  -d '{"name":"Test User","email":"test@example.com","role":"user"}'

# Update user
curl -X PUT http://<alb-url>/api/users/1 \
  -H "Content-Type: application/json" \
  -d '{"name":"Updated Name"}'

# Delete user
curl -X DELETE http://<alb-url>/api/users/1
```

**Test Product Service:**
```bash
# List all products
curl http://<alb-url>/api/products

# Filter by category
curl "http://<alb-url>/api/products?category=Electronics"

# Filter by price range
curl "http://<alb-url>/api/products?minPrice=50&maxPrice=500"

# Get specific product
curl http://<alb-url>/api/products/1
```

### Health Checks
```bash
# Check target health
aws elbv2 describe-target-health \
  --target-group-arn <target-group-arn>

# Check ECS service status
aws ecs describe-services \
  --cluster microservices-cluster \
  --services microservices-user-service microservices-product-service
```

---

## ğŸ“Š Monitoring

### View Logs

**CloudWatch Logs:**
```bash
# User service logs
aws logs tail /ecs/microservices/user-service --follow

# Product service logs
aws logs tail /ecs/microservices/product-service --follow
```

**AWS Console:**
1. Navigate to CloudWatch â†’ Log groups
2. Select `/ecs/microservices/user-service` or `/ecs/microservices/product-service`
3. View log streams

### View Metrics

**CloudWatch Metrics:**
1. Navigate to CloudWatch â†’ Metrics â†’ ECS
2. Select your cluster: `microservices-cluster`
3. View CPU, Memory, Request Count, Response Time

### Set Up Alarms
```bash
# High CPU alarm
aws cloudwatch put-metric-alarm \
  --alarm-name user-service-high-cpu \
  --alarm-description "Alert when CPU exceeds 80%" \
  --metric-name CPUUtilization \
  --namespace AWS/ECS \
  --statistic Average \
  --period 300 \
  --threshold 80 \
  --comparison-operator GreaterThanThreshold \
  --evaluation-periods 2
```

---

## ğŸ’° Cost Optimization

### Monthly Cost Breakdown

| Resource | Monthly Cost | Optimization |
|----------|-------------|--------------|
| NAT Gateway | ~$32 | Use single NAT (done) |
| ALB | ~$16 | Required for production |
| ECS Fargate (2 tasks) | ~$15 | Use Fargate Spot for non-prod |
| Data Transfer | ~$5 | Minimize cross-AZ traffic |
| CloudWatch Logs | ~$2 | 7-day retention (done) |
| ECR Storage | <$1 | Lifecycle policies (done) |
| **Total** | **~$70/month** | |

### Cost Optimization Tips

1. **Use Fargate Spot** (70% savings for non-critical workloads)
2. **Scale to zero** during off-hours for dev/test environments
3. **Use single NAT Gateway** (already implemented)
4. **Short log retention** (7 days - already implemented)
5. **Clean up old ECR images** (lifecycle policy - already implemented)

---

## ğŸ§¹ Cleanup

To avoid ongoing charges, delete all resources:

### Automated Cleanup
```bash
cd infrastructure/scripts
./cleanup.sh
```

### Manual Cleanup

Delete stacks in reverse order:
```bash
aws cloudformation delete-stack --stack-name microservices-ecs-services
aws cloudformation delete-stack --stack-name microservices-alb
aws cloudformation delete-stack --stack-name microservices-ecs-cluster
aws cloudformation delete-stack --stack-name microservices-ecr
aws cloudformation delete-stack --stack-name microservices-vpc
```

**Note:** Wait for each stack to delete before proceeding to the next.

---

## ğŸ“š What I Learned

Building this project taught me:

### Cloud Architecture
- Designing multi-tier applications in AWS
- Understanding VPC networking (public vs private subnets, NAT gateways)
- Implementing load balancing and traffic routing
- Multi-AZ deployment for high availability

### Containerization
- Dockerizing Node.js applications
- Container security best practices
- Managing container images with ECR
- Container orchestration with ECS Fargate

### Infrastructure as Code
- Writing CloudFormation templates
- Managing infrastructure dependencies
- Creating modular, reusable infrastructure code
- Automated deployments with scripts

### DevOps Practices
- CI/CD pipeline concepts
- Blue/green deployment strategies
- Automated health checks and monitoring
- Centralized logging strategies

### AWS Services Deep Dive
- ECS Fargate vs EKS trade-offs
- Application Load Balancer configuration
- IAM roles and policies
- CloudWatch monitoring and alerting

---

## ğŸ”® Future Enhancements

Potential improvements for this project:

- [ ] **Add API Gateway** for rate limiting, caching, and API key management
- [ ] **Implement CI/CD** with GitHub Actions or AWS CodePipeline
- [ ] **Add RDS Database** for persistent data storage
- [ ] **Add Redis Cache** with ElastiCache for session management
- [ ] **Implement X-Ray** for distributed tracing
- [ ] **Add WAF** for web application firewall
- [ ] **Custom Domain** with Route 53 and SSL certificate
- [ ] **Add Authentication** with Cognito or JWT
- [ ] **Automated Testing** with Jest or Mocha
- [ ] **Add Swagger/OpenAPI** documentation

--- 

## ğŸ“ License

This project is licensed under the MIT License 


